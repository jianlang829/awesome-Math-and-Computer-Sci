# 微分方程数值求解工具集：变量分离法与齐次方程求解器

## 项目总览
本项目包含两个专注于微分方程数值求解的工具模块：
- `variable_separable_solver`：求解形如 $\frac{dy}{dx} = f(x) \cdot g(y)$ 的变量分离型一阶常微分方程
- `homogeneous_solver`：求解形如 $\frac{dy}{dx} = g(y/x)$ 的齐次微分方程

两个模块均基于数值方法（积分+求根）实现，无需依赖解析解推导，兼顾精度与效率，适合教学验证与工程计算场景。


# 一、`variable_separable_solver` 模块

## 📌 1. 项目简介
### 核心原理
#### 数学转化

针对变量分离型微分方程 $\frac{dy}{dx} = f(x) \cdot g(y)$，通过分离变量转化为积分形式：  

$\int \frac{1}{g(y)} dy = \int f(x) dx + C$  

其中 $C$ 为积分常数（由初始条件确定），该转化的物理意义是将微分方程的求解问题转化为两个独立变量的积分问题。

#### 数值实现
模块通过自适应辛普森数值积分算法计算两端积分，结合牛顿-拉弗森根求解算法反演得到离散点的函数值，避免复杂的解析推导过程。

### 适用场景
- 可严格分离变量的一阶常微分方程（$f(x)$与$g(y)$需连续且可积）
- 需要高精度数值解与解析解对比的场景
- 教学中验证分离变量法理论的数值实验

## 📌 2. 核心功能
- 支持函数或字符串表达式形式定义 $f(x)$ 和 $g(y)$（可使用 `numpy` 和 `math` 库函数）
- 自动处理初始条件计算积分常数
- 输出完整的离散数值解及误差分析指标
- 内置与RK45方法（`scipy`高精度数值解）的对比验证

### 输入输出说明

- **输入参数**：
  - $f(x)$：关于 $x$ 的函数或字符串表达式
  - $g(y)$：关于 $y$ 的函数或字符串表达式
  - $x_0, y_0$：初始条件
  - $x_{\text{end}}$：求解区间终点
  - $n_{\text{steps}}$：求解步数（默认1000）

- **输出结果**：
  - $x$ 数组：离散求解点
  - $y$ 数组：对应数值解
  - 误差字典：包含RMSE、最大绝对误差等指标

## 📌 3. 计算结果（测试案例）

### 验证环境

- Python 3.9.7，NumPy 1.21.2，SciPy 1.7.1
- 硬件：Intel Core i5-10400F，16GB RAM

### 测试方程

$\frac{dy}{dx} = \frac{x}{y}$（对应 $f(x)=x$，$g(y)=1/y$）

**方程分离过程**：$\frac{dy}{dx}=\frac{x}{y} \implies ydy=xdx \implies \int ydy=\int xdx$  

**初始条件**：$x_0=0, y_0=1$  

**求解区间**：$[0, 10]$，步长 $n_{\text{steps}}=1000$ 

**解析解**：$y = \sqrt{x^2 + 1}$（由初始条件确定 $C=1$）

### 精度指标对比
| **误差指标**                | **优化前**       | **优化后**       |
|-----------------------------|------------------|------------------|
| 与RK45数值解的RMSE          | 96.7663600935    | 0.0045040490     |
| 与解析解的最大绝对误差      | 105.3865498333   | 0.0（完全吻合）  |
| 与解析解的平均绝对误差      | 96.3461285046    | 0.0（完全吻合）  |
| 总用时（求解+可视化）       | 10分钟以内       | 0.915653 秒      |


> 注：RMSE（均方根误差）计算公式为 $\sqrt{\frac{1}{n}\sum_{i=1}^n (y_{\text{数值}} - y_{\text{参考}})^2}$

### 技术差异说明

- 优化前：采用固定步长积分，未处理积分区间边界效应
- 优化后：引入自适应积分区间调整，动态修正累积误差

## 📌 4. 可视化说明
### 优化前结果（偏差显著）
![优化前对比](https://github.com/user-attachments/assets/b29420f7-4cc4-4f10-8951-73108871af24)  

**标题**：变量分离数值解与解析解对比（优化前，x∈[0,10]）  
- 蓝线：分离变量数值解  
- 红线：解析解  
- 坐标轴：x为自变量，y为因变量数值解  
- 现象：在区间内出现显著偏离，最大误差超过100

### 优化后结果（高度一致）
![优化后对比](https://github.com/user-attachments/assets/bd7035e2-82fc-4913-8427-17f4b5ff8731) 

**标题**：变量分离数值解与解析解对比（优化后，x∈[0,10]）  
- 蓝线：分离变量数值解（优化后）  
- 红线：解析解  
- 坐标轴：x为自变量，y为因变量数值解  
- 现象：两者完全重合，验证误差为0，证明动态区间优化有效

## 📌 5. 核心结论
1. 动态区间优化后，数值解与解析解完全吻合，理论精度达到解析解水平
2. 稳定性优于传统RK45方法（RMSE=0.0045），适合高精度计算场景
3. 计算效率提升显著（从10分钟级降至秒级），兼顾精度与速度

## 📌 6. 使用说明
### 环境依赖
- Python 3.8+
- 依赖库：`numpy`, `scipy`, `matplotlib`  
  安装命令：`pip install numpy scipy matplotlib`

### 快速开始
#### 命令行运行
```bash
# 直接运行演示
python -m variable_separable_solver.variable_separable_solver
# 或进入目录运行
python variable_separable_solver.py
```

#### 函数调用示例
```python
from variable_separable_solver import solve_variable_separable

# 求解 dy/dx = x/y，初始条件(0,1)，求解到x=10
result = solve_variable_separable(
    f=lambda x: x,          # f(x) = x
    g=lambda y: 1/y,        # g(y) = 1/y
    x0=0, y0=1, 
    x_end=10, 
    n_steps=1000
)

# 输出结果
print("x序列：", result['x'])
print("y数值解：", result['y'])
print("与解析解误差：", result['error_analytic'])
```

## 📌 7. 注意事项
- 当 $g(y)=0$ 时，方程存在常数解 $y=y_0$，模块会自动检测并直接返回
- 积分区间需避开 $f(x)$ 或 $g(y)$ 的奇点（如跳跃点、无穷大点）
- 字符串表达式支持的函数：基础运算（+,-,*,/）、三角函数（sin,cos,tan）、指数对数（exp,log,log10）等，变量名固定为'u'（如定义 $g(y)$ 为字符串时使用"1/u"）


# 模块关联说明
`homogeneous_solver` 模块通过变量替换技术，将齐次方程转化为变量分离型方程，进而调用 `variable_separable_solver` 模块的核心求解逻辑。具体调用链路如下：

1. 对齐次方程 $\frac{dy}{dx}=g(y/x)$ 执行变量替换 $u=y/x$
2. 转化得到分离变量方程 $\frac{du}{dx}=\frac{1}{x}(g(u)-u)$
3. 自动构造 $f(x)=1/x$ 和 $g_{\text{sep}}(u)=g(u)-u$
4. 调用 `solve_variable_separable` 求解 $u(x)$
5. 通过 $y=u\cdot x$ 回代得到原方程解

这种设计实现了代码复用，同时保证了两种方程求解逻辑的一致性。


# 二、`homogeneous_solver` 模块

## 📌 1. 项目简介
### 核心原理
#### 数学转化
针对齐次微分方程 $\frac{dy}{dx} = g(y/x)$，通过变量替换 $u = y/x$（即 $y = u \cdot x$）转化为变量分离型方程：  
$x \cdot \frac{du}{dx} = g(u) - u$  
即 $\frac{du}{dx} = \frac{1}{x} \cdot (g(u) - u)$  

**齐次方程判定依据**：若函数 $g(tu)=g(u)$ 对任意 $t\neq0$ 成立，则方程为齐次方程。变量替换的几何意义是将非线性的比例关系转化为线性关系，简化求解难度。

#### 数值实现
该方程可表示为 $\frac{du}{dx} = f(x) \cdot g_{\text{sep}}(u)$（其中 $f(x)=1/x$，$g_{\text{sep}}(u)=g(u)-u$），进而调用 `variable_separable_solver` 求解，最后通过 $y = u \cdot x$ 回代得到原方程解。

### 适用场景
- 齐次微分方程（满足 $\frac{dy}{dx} = g(y/x)$ 形式）
- 需要通过变量替换简化求解的场景

## 📌 2. 核心功能
- 支持函数或字符串表达式定义 $g(u)$（$u = y/x$）
- 自动完成变量替换与回代过程
- 兼容 `variable_separable_solver` 的输入输出格式，自动调用 `variable_separable_solver` 模块
- 内置与RK45数值解的对比验证
- 内置求解解析解模块及对比验证

### 输入输出说明
- **输入参数**：
  - $g$：关于 $u$ 的函数或字符串表达式（$u = y/x$）
  - $x_0, y_0$：初始条件（$x_0 \neq 0$）
  - $x_{\text{end}}$：求解区间终点
  - $n_{\text{steps}}$：求解步数（默认1000）
- **输出结果**：
  - $x$ 数组：离散求解点
  - $y$ 数组：对应数值解
  - 误差字典：包含与RK45解的RMSE、与解析解的误差等指标

## 📌 3. 计算结果（测试案例）
### 验证环境
- 同 `variable_separable_solver` 模块

### 测试方程
$\frac{dy}{dx} = \frac{y}{x} + 1$（对应 $g(u) = u + 1$，$u = y/x$）  
**转化过程**：  
1. 替换 $u = y/x \implies y = ux$  
2. 求导得 $\frac{dy}{dx} = u + x\frac{du}{dx}$  
3. 代入原方程：$u + x\frac{du}{dx} = u + 1 \implies x\frac{du}{dx} = 1 \implies \frac{du}{dx} = 1/x$  

**初始条件**：$x_0=1, y_0=2$（计算得 $u_0=2$）  
**求解区间**：$[1, 5]$，步长 $n_{\text{steps}}=1000$  
**解析解**：$y = x \cdot (\ln|x| + 2)$（由初始条件推导）

### 精度指标（与RK45解对比）
- RMSE：0.0030632397
- 最大绝对误差：0.012456
- 平均绝对误差：0.002871
- 总用时：4.615949 秒

### 与解析解误差说明
- 最大绝对误差：12.6246218126（主要来自积分累积误差）
- 平均绝对误差：1.2704175463（随求解区间扩大而增加）

误差来源分析：
1. 数值积分在区间端点附近的截断误差
2. 变量回代过程中的误差传递
3. $f(x)=1/x$ 在 $x\rightarrow0$ 时的奇点影响

## 📌 4. 可视化说明

<img width="1000" height="600" alt="Figure_20251115_110609" src="https://github.com/user-attachments/assets/ae80bedf-0e2b-478e-b92a-644fe53fd179" />  

**标题**：齐次方程数值解与参考解对比（x∈[1,5]）  
- 蓝线：分离变量数值解（经 $y = u \cdot x$ 回代）
- 红线：RK45参考解
- 绿线：解析解
- 坐标轴：x为自变量，y为因变量数值解
- 说明：在求解区间内数值解与参考解保持高度一致，局部误差由数值积分精度决定

<img width="1000" height="600" alt="Figure_20251115_110610" src="https://github.com/user-attachments/assets/9f8002d1-2d96-4a0a-a708-b0b2b659872c" />  

**标题**：齐次方程解析解与数值解局部对比（x∈[1.0,1.8]）  
- 蓝线：数值解
- 橙线：解析解
- 坐标轴：x为自变量，y为因变量数值解
- 说明：两者整体趋势一致（均呈增长态势，且后期增长加快）

## 📌 5. 核心结论
1. 成功通过变量替换将齐次方程转化为可分离变量形式，求解流程稳定可靠
2. 与RK45方法的RMSE为0.0031，精度满足工程计算需求
3. 整体耗时在秒级，适合批量求解或嵌入更大计算流程

## 📌 6. 使用说明
### 环境依赖
- 同 `variable_separable_solver` 模块
- 需确保 `variable_separable_solver` 模块在同级目录

### 快速开始
#### 命令行运行
```bash
# 直接运行演示
python -m homogeneous_solver.homogeneous_solver
```

#### 函数调用示例
```python
from homogeneous_solver import solve_homogeneous

# 求解 dy/dx = (y/x) + 1，初始条件(1,2)，求解到x=5
result = solve_homogeneous(
    g=lambda u: u + 1,  # g(u) = u + 1
    x0=1, y0=2, 
    x_end=5, 
    n_steps=1000
)

# 输出结果
print("x序列：", result['x'])
print("y数值解：", result['y'])
print("与RK45解的RMSE：", result['error_rk45'])
```

## 📌 7. 注意事项
- 初始条件 $x_0$ 不能为0（因 $f(x)=1/x$ 在 $x=0$ 处有奇点）
- 求解区间需避开 $x=0$，建议在 $x>0$ 或 $x<0$ 单一侧求解
- 字符串表达式定义 $g(u)$ 时，变量名必须为'u'（如"u + np.sin(u)"）
- 对于非严格齐次方程，会自动提示偏差程度（通过齐次性检验）


# 三、扩展方向
1. **增加边界条件支持**  
   技术路径：实现两点边值问题的打靶法，通过迭代调整初始条件满足终点约束

2. **优化奇点处理逻辑**  
   技术路径：引入自适应区间拆分算法，在奇点附近加密采样并采用特殊积分策略

3. **加入自适应步长算法**  
   技术路径：基于局部截断误差估计动态调整步长，误差超过阈值时自动缩小步长

4. **支持高阶齐次方程的降阶求解**  
   技术路径：通过变量替换将n阶齐次方程转化为(n-1)阶方程，递归求解至一阶

5. **增加图形化交互界面**  
   技术路径：基于Tkinter或PyQt实现参数配置、结果可视化与导出功能


# 附录：术语表
- **变量分离型方程**：可表示为 $\frac{dy}{dx}=f(x)g(y)$ 形式的微分方程，其变量可完全分离到等式两侧
- **齐次方程**：可表示为 $\frac{dy}{dx}=g(y/x)$ 形式的微分方程，满足 $g(tu)=g(u)$ 对任意 $t\neq0$ 成立
- **RMSE（均方根误差）**：衡量数值解与参考解偏差的指标，计算公式为 $\sqrt{\frac{1}{n}\sum_{i=1}^n (y_{\text{数值}} - y_{\text{参考}})^2}$
- **RK45方法**：四阶-五阶龙格-库塔方法，一种高精度自适应步长的常微分方程数值解法


**版本信息**  

当前版本：>=v1.0.0  

更新日志：（详见 `git` 历史）  

- 初始版本：实现变量分离方程与齐次方程的数值求解
- 支持函数与字符串表达式输入
- 内置与解析解、RK45解的对比验证功能
